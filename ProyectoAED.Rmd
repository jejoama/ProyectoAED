---
title: Evolución de la actividad, ocupación para grupos de edad mayores de 16 años
author:
  - name: Jeremy Joel Aguilar Marin
  - name: Jose Aguilar Milla
  - name: Javier Herrero Pérez

journal: notspecified 
type: article
status: submit
# front matter
simplesummary: |
  A Simple summary goes here.
abstract: |
  Este estudio realiza un análisis exploratorio y estadístico de la Encuesta de Población Activa (EPA) para evaluar la evolución de la brecha de género en el mercado laboral español entre el 2000 y 2024.
  Los resultados clave validados mediante pruebas de t de student, demuestran que la tasa de paro y de actividad dependen del sexo. 

keywords: |
  Brecha de Género; Tasa de Actividad; Análisis de Series de Tiempo; t de Student.


bibliography: mybibfile.bib
endnotes: false
output: 
  rticles::mdpi_article:
    extra_dependencies: longtable

---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(
  message = FALSE,     # Oculta mensajes de carga (por ejemplo, de librerías)
  warning = FALSE     # Oculta advertencias
)
```



```{r,echo = FALSE}
rm(list=ls())
```


```{r,echo = FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  readr,
  dplyr,
  tidyr,
  stringr,
  forcats,
  ggplot2,
  visdat,
  treemapify,
  gganimate,
  gifski,
  knitr
)
```


# Introducción
Este artículo presenta un enfoque en R para el Análisis Exploratorio de Datos de la Encuesta de Población Activa (EPA), centrándose en la evolución histórica de la brecha de género en el mercado laboral español. Utilizando el ecosistema `tidyverse`, el estudio comienza con una limpieza y transformación de los datos empleando `dplyr` y el cálculo de Tasa de paro y actividad, claves para el análisis. Seguido de la visualización con `ggplot2` para ilustrar la evolución temporal. Por último, se validan los resultados con pruebas de *t Student* para confirmar la significancia estadística de los resultados.

La cuestión que queremos resolver en el trabajo es ver si hay relación entre la tasa de paro y de actividad con el sexo basándonos en la hipótesis de que existe una brecha de género en el mercado.
Para este análisis nos hemos basado principalmente en las tasas de paro y de actividad por considerarlas los indicadores más representativos del mercado laboral. Son los mejores indicadores porque permite entender tanto quién participa en el mercado laboral mediante la tasa de actividad como quién logra empleo dentro de él con la tasa de paro.



Los datos se han obtenido del INE a fecha de 21/10/2025.

# Exploración inicial

## Importación y verificación inicial

```{r, include=FALSE}
# Para comprobar la codificación del archivo
guess_encoding("data/65948.csv")
```


La codificación de los datos brutos es `UFT-8` con una confianza del $100\%$, el archivo está delimitado por tabulaciones, se indica que el separador decimal es la coma y que los valores *NA* están codificados como `".."`.

```{r,echo = FALSE}
df<-read_delim("data/65948.csv", delim = "\t", escape_double = FALSE, na = "..", 
               trim_ws = TRUE,locale = locale(decimal_mark = ","))
```


Las variables del dataframe original son: Sexo, Edad, Relación con la actividad económica, Periodo y Total.


## Valores faltantes

Los valores NA se encuentran concentrados en la variable `Total`, mostrando una ausencia específica en las categorías de situación laboral relacionadas con el desempleo como se muestra en la siguiente figura:

```{r,echo = FALSE,fig.width=6, fig.height=4, out.width="100%"}
df %>% rename(Situacion_Laboral = "Relación con la actividad económica") %>% filter(is.na(Total)) %>% ggplot(aes(x=Situacion_Laboral))+geom_bar(aes(fill=Edad))+labs(
    title = "Frecuencia de los registros faltantes NA",
    subtitle = "Distribución por Situación Laboral y la edad",
    y = "Valores faltantes", # Quitamos la etiqueta redundante del eje Y
    x = "Número de Registros con NA"
  ) +
  theme_minimal()
```

Se observa que los datos faltantes son del tipo MAR (Missing At Random). La ausencia de datos viene asociada a grupos de edad altos con una relación con la actividad económica de "Parados que buscan primer empleo" o "Parados". Esta dependencia permite concluir que este valor NA se debe a que es imposible, o extremandamente improbable, que una persona en ese rango de edad busque su primer empleo.




# Definición de variables

El valor de la columna `Total` viene definido con la siguiente expresión:
\begin{equation}
\text{Total}=\text{Activos}+\text{Inactivos}
\end{equation}

Y los **Activos** se dividen en Ocupados y Parados:
\begin{equation}
\text{Activos}=\text{Ocupados}+\text{Parados}
\end{equation}

## Fórmulas para el análisis (Tasas)

Las tasas permiten normalizar los datos y son la base para el análisis de brechas y series temporales:


La **tasa de paro** mide la proporción de la población activa que está desempleada:

\begin{equation}
\text{Tasa de paro}=\frac{\text{Parados}}{\text{Activos}} \cdot 100
\end{equation}


La **tasa de actividad** mide la participación de una población en el mercado laboral:
\begin{equation}
\text{Tasa de actividad}=\frac{\text{Activos}}{\text{Total}} \cdot 100
\end{equation}

<!-- Lo quitamos porque no lo usamos al final
<!-- La **tasa de ocupación** muestra qué parte de la población total de referencia tiene un empleo: -->

<!-- \begin{equation} -->
<!-- \text{Tasa de ocupación}=\frac{\text{Ocupados}}{\text{Total}} \cdot 100 -->
<!-- \end{equation} -->



# Limpieza de los datos

La limpieza de los datos a consistido en estos puntos:

- **Renombrar columnas**: Utilizando `rename()` para acortar `"Relación con la actividad económica"` por ` "Situacion_Laboral"` para simplificar el manejo de columnas.

- **Filtrado de doble conteo**: Se eliminan las instancias donde las variables representan la suma de otras instancias (`Sexo="Ambos sexos"` y `Edad="Total"`) para evitar doble conteo y así verificar que cada registro sea una observación única.

- **Se aplica `pivot_wider()`** utilizando los valores de la columna `Situacion_Laboral` para crear las nuevas columnas (`names_from`) y los valores numéricos de la columna `Total`.

- **Renombrar variables**: Se renombra la columna "parados que buscan primer empleo" a un formato más corto `r "ParadosSinExperiencia"`

- **Imputación de NA a 0**: Los valores faltantes se concentran en categorías como personas mayores en paro o que buscan su primer empleo. El INE suprime el dato por ser un valor insignificante, por lo que se opta por remplazar los valores NA a 0 para no perder el resto de información válida de la instancia.

- **Creación de tasas**: Se añaden las columnas `Tasa_paro` y `Tasa_actividad` utilizando `mutate()` y las expresiones de la EPA.

- **Ordenación en factores**: Se ordena la columna `Edad` como un factor ordinal y la columna `Sexo` como factor nominal.

```{r,echo = FALSE}
df_clean<-df %>% 
  rename(Situacion_Laboral = "Relación con la actividad económica") %>% 
  filter(Sexo != "Ambos sexos", Edad != "Total") %>% 
  mutate(Sexo=as.factor(Sexo), Edad=as.factor(Edad),
         Situacion_Laboral=as.factor(Situacion_Laboral)) %>%
  pivot_wider(names_from = Situacion_Laboral,values_from = Total) %>% 
  rename(ParadosSinExperiencia="Parados que buscan primer empleo") %>% 
  mutate(across(.cols=c(Parados,ParadosSinExperiencia,Activos,Ocupados,Inactivos),
                .fns=~replace_na(.,0))) %>% 
  mutate(across(c(Activos, Ocupados, Parados, Inactivos, Total), as.numeric),Tasa_paro=Parados/Activos*100,Tasa_actividad=Activos/Total*100) %>% 
  mutate(
    Edad = str_replace(Edad, "De ", ""),
    Edad = str_replace(Edad, " a ", "-"),
    Edad = str_replace(Edad, " años", ""),
    Edad = str_replace(Edad, "70 y más", "70+"),
    
    Edad = factor(Edad, levels = c(
      "16-19", "20-24", "25-29", "30-34", "35-39", 
      "40-44", "45-49", "50-54", "55-59", "60-64", 
      "65-69", "70+"), ordered = T
      )
  )
```


## Outliers

Para identificar outliers se va a utilizar el método del rango intercuartílico (IQR) ya que permite la detección de outliers sin asumir la normalidad de la distribución. 
Se obtiene que para la tasa de actividad no hay valores outliers, sin embargo, para la tasa de paro sí. Se tendrá en cuenta este resultado para evitar trabajar con estos valores atípicos cuando se estudie la tasa de paro.

```{r,echo = FALSE}

detectar_outliers_IQR <- function(df, tasa) {
  # Calcular los límites de IQR
  x <- df[[tasa]]
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR_val <- Q3 - Q1
  limite_superior <- Q3 + 1.5 * IQR_val
  limite_inferior <- Q1 - 1.5 * IQR_val

  # Crear vector con etiquetas
  etiqueta <- if_else(
    x > limite_superior, "AtipicoSuperior",
    if_else(x < limite_inferior, "AtipicoInferior", "Normal")
  )

  # Crear el nombre de la nueva columna
  nombre_col <- paste0("Outlier_", sub("Tasa_", "", tasa))

# Hacer la etiqueta como un factor
  etiqueta <- factor(etiqueta,levels = c("AtipicoInferior", "Normal", "AtipicoSuperior"))
  df[[nombre_col]] <- etiqueta

  return(df)
}
# Se añade nuevas columnas al daframe con los valores Outliers
df_clean <- df_clean %>%
  detectar_outliers_IQR("Tasa_actividad") %>%
  detectar_outliers_IQR("Tasa_paro")

```




```{r,echo = FALSE}
# Guardar los datos
write_csv(df_clean,file = "data/df_clean.csv")
```



# Análisis de las tasas

## Distribución de la tasa de actividad y paro por sexo

En las siguientes gráficas se va a estudiar la distribución general de las tasas a lo largo de todo el periodo y separado por sexo.

```{r,echo = FALSE,fig.width=6, fig.height=4, out.width="100%"}
df_clean %>% ggplot(aes(x = Sexo, y = Tasa_actividad, fill = Sexo)) +
  geom_boxplot() + guides(fill = "none")+
  labs(
    title = "Distribución de la Tasa de Actividad por Sexo (Análisis Global)",
    subtitle = "El boxplot visualiza la mediana, la dispersión y la asimetría de la brecha.",
    y = "Tasa de Actividad (%)",
    x = NULL
  )  + 
  theme_minimal()
```

En este primer gráfico se muestra la tasa de actividad para hombres y mujeres. Se observa una clara y pronunciada separación entre estas distribuciones. La mediana de la tasa de actividad para hombres es superior a la de las mujeres. Además, la caja del grupo masculino se sitúa por encima del grupo femenino.

```{r,echo = FALSE,fig.width=6, fig.height=4, out.width="75%"}
df_clean %>% 
  ggplot(aes(x = Sexo, y = Tasa_paro)) +
  
  geom_boxplot(aes(fill = Sexo), outlier.shape = NA) +
  
  geom_jitter(
    # Filtra solo los outliers
    data = . %>% filter(Outlier_paro != "Normal"),
    # CLAVE 1: Mapear 'color' a una etiqueta constante para crear la leyenda
    aes(color = Edad), 
    width = 0.2,
    alpha = 0.8 # Añadimos transparencia para mejor visualización
  ) +
  
  guides(fill = "none", # Quita la leyenda 'Sexo' generada por aes(fill=Sexo)
         color = guide_legend(title = "Outliers (años)")) + # Da un título a la leyenda de outliers
  
  labs(
    title = "Distribución de la Tasa de Paro por Sexo (Análisis Global)",
    subtitle = "Los puntos atípicos corresponden al rango de edad de 16 a 24 años.",
    y = "Tasa de Paro (%)",
    x = NULL
  ) + 
  theme_minimal()

```
A diferencia de la tasa de actividad, en este gráfico se aprecia una mayor superposición entre las distribuciones de ambos sexos. Las medianas de ambas distribuciones se encuentra más cercanas.

A diferencia de la tasa de actividad donde no se han detectado outliers, la tasa de paro muestra una alta concentración de valores atípicos en ambos sexos. Los puntos atípicos se han filtrado y coloreado según el rango de edad.

Los valores atípicos en la tasa de paro están ligados a la variable de edad. Estos valores no son errores de registro sino la muestra del paro juvenil. Estos valores outliers se omitirán cuando se haga análisis relacionados con la tasa de paro.

## Evolucion de la tasa de paro y de la brecha de paro por género

En este bloque de código se construyen varias representaciones gráficas con el fin de analizar la evolución de la tasa de paro y la brecha de género a lo largo del tiempo. Para ello, se parte de una tabla en la que se calcula la variable *brecha_paro*, definida como la diferencia entre la tasa de paro de mujeres y la de hombres. Posteriormente, los datos se agrupan por periodo para obtener las tasas medias anuales de paro por sexo y la brecha media correspondiente. 


Agrupación de datos por periodo y por sexo
```{r, echo=FALSE}
# Calculamos la media de la tasa de actividad para cada grupo
df_p_sexo <- df_clean %>% group_by(Periodo, Sexo) %>% summarise(tasa_actividad = mean(Tasa_actividad, na.rm = TRUE) #Hay que ignorar los valores NA
                                                                , .groups = "drop")
```

```{r, fig.width=6, fig.height=4, out.width="75%",echo=FALSE}
# Gráfica 
ggplot(df_p_sexo, aes(x = Periodo, y = tasa_actividad, color = Sexo)) + geom_line(linewidth = 2) +  labs(title = "Tasa de actividad según sexo (2006–2024)", x = "Año", y = "% Tasa de actividad",color = "Sexo") + theme_minimal()  

# Eje X:Periodo -  Eje Y: tasa de actividad promedio


```


La gráfica enseña la evolución de la tasa de actividad en España entre los años 2006 y 2024, diferenciada por sexo. Por un lado, la proporción de hombres es mucho mayor a la de mujeres, cosa que va ligada a que los hombres siempre han tenido mayor participicaion en muchos mas sectores, como lo puede ser la construcción, y a que las mujeres se ligan mas al cuidado familiar.
    Pese a esto, la actividad masculina en 2008 se desacelera economicamente, esto provocado por la crisis financiera que se vivió en la epoca. Es en 2017/18 que comienza su recuperación, pero nunca a los niveles previos a la crisis. En 2020, debido al Covid-19, se observa otra caida en la tendencía (porque el Covid-19 afectó a muchos sectores, como la industría por ejemplo). Aunque se observa también su recuperació, tampoco volvió a los nieveles previos de la crisis de 2008
    por el otro lado, la tasa de actividad femenina se muestra, en el periodo, ascendente ya que han ido incorporandose cada vez mas en el mercado laboral español.


```{r, echo=FALSE}
# Agrupamos por Periodo, sexo y Edad
##Que pretendemos? Calcular la media de la tasa de actividad para cada combinación
df_sexo_edad <- df_clean %>%  group_by(Periodo, Sexo, Edad) %>% summarise(tasa_actividad = mean(Tasa_actividad, na.rm = TRUE),.groups = "drop")

```

```{r, echo=FALSE}

ggplot(df_sexo_edad, aes(x = Periodo, y = tasa_actividad, color = Edad)) + geom_line(linewidth = 1) +  facet_wrap(~Sexo) + scale_x_continuous(breaks = seq(2006, 2024, by = 2)) + scale_y_continuous(labels = scales::comma) +  labs(title = "Tasa de actividad por edad y sexo (2006–2024)", x = "Año", y = "Tasa de actividad (%)", color = "Edad") + theme_minimal()  + theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))

```
Como se observa en la gráfica, los hombres presentan tasas de actividad mucho más elevadas que las mujeres, sobretodo en el rango de 30 y 54 años. En ambos sexos, la tasa decae a partir de los 60 años, reflejando consigo la desigualdad en el mercado cuando se trata de envejecimiento



```{r, echo=FALSE,fig.width=6, fig.height=4, out.width="75%"}
df_paro_sexo <- df_clean %>% filter(Outlier_paro=="Normal")%>%  group_by(Periodo, Sexo) %>% summarise(tasa_paro = mean(Tasa_paro, na.rm = TRUE), .groups = "drop")

ggplot(df_paro_sexo, aes(x = Periodo, y = tasa_paro, color = Sexo)) + geom_line(size=2) + scale_x_continuous(breaks = seq(2006, 2024, by = 2))+ labs(title = "Tasa de paro por sexo (2006–2024)", x = "Año", y = "Tasa de paro (%)") + theme_minimal()

```
Desde la crisis de 2008, la tasa de paro en ambos sexos ha ido aumentado progresivamente hasta 2013, año en el que empezó a decaer. Lo que se observa, además, es como desde 2014 el paro en mujeres es mucho mas alto que el de hombres, reflejando la brecha persisitente.  Por tanto, aunque ambos sexos sufren paro, las mujeres tienen mas dificultades para acceder (o incluso mantenerse) a trabajos. 



El gráfico a continuación representa la evolución de la brecha de paro total.
```{r, echo=FALSE,fig.width=6, fig.height=4, out.width="75%"}
# 1º crear una tabla con la variable brecha_paro 
brecha <- df_clean %>% filter(Outlier_paro=="Normal")%>% 
  select(Periodo, Edad,Sexo,Tasa_paro) %>% 
  pivot_wider(names_from = Sexo, values_from = Tasa_paro) %>% 
  mutate(brecha_paro=Mujeres-Hombres)


#2º Agrupar esas fechas por periodo, para asi no diferenciar entre grupos de edades y tener la brecha total
brechas_total <- brecha %>%
  group_by(Periodo) %>%
  summarise(
    tasa_hombres = mean(Hombres, na.rm = TRUE),
    tasa_mujeres = mean(Mujeres, na.rm = TRUE),
    brecha_paro_total = mean(brecha_paro, na.rm = TRUE)
  )


evo_brecha_total <- ggplot(brechas_total,aes(x=Periodo,y=brecha_paro_total)) + geom_line()+geom_point()+labs(title = "Evolución de la brecha de paro total",x="años",y="Brecha de tasa de paro")+ theme_minimal()
evo_brecha_total

```

El gráfico previo representa la evolución de la brecha de paro total. En él se observa cómo la diferencia entre hombres y mujeres en la tasa de paro varía a lo largo del tiempo, con un aumento notable en los años posteriores a la crisis de 2008 y una ligera reducción en la última etapa analizada. 

## Evolucion de la tasa de paro y su brecha por grupo de edad


```{r, echo=FALSE}
brecha_edades <- df_clean %>%  filter(Outlier_paro=="Normal")%>% 
  select(Sexo, Edad, Periodo,Tasa_paro) %>% 
  pivot_wider(names_from = Sexo, values_from = Tasa_paro) %>% 
  mutate(brecha_paro=Mujeres-Hombres)

```

## Gráfica de Barras comparación grupos de edades con mayor brecha en 2006 y en 2024

En este apartado se elaboran una serie de gráficos de barras destinados a analizar la evolución de la brecha de paro por grupos de edad a lo largo del tiempo. En cada uno de ellos, las barras representan la magnitud de la brecha en los distintos grupos de edad, mientras que la línea discontinua negra indica la media general de la brecha para ese año.

```{r, echo=FALSE}

a1<- brecha_edades %>% filter(Periodo %in% 2024) 

library(ggplot2)
library(dplyr)

rango_y <- range(brecha_edades$brecha_paro)
años<- unique(df_clean$Periodo)

# Definir los años que quieres graficar
años <- c(2024, 2020, 2010, 2007, 2006)

# Calcular rango del eje Y (opcional, si ya lo tienes definido)
rango_y <- range(brecha_edades$brecha_paro, na.rm = TRUE)

# Generar gráficos solo para esos años
graficos_brecha_paro <- lapply(años, function(año) {
  brecha_edades %>%
    filter(Periodo == año) %>%
    ggplot(aes(x = factor(Edad, levels = unique(Edad)), y = brecha_paro)) +
    geom_col(fill = "steelblue") +
    ylim(rango_y) +
    labs(
      title = paste("Brecha de paro por grupo de edad"),
      x = "Grupo de edad",
      y = "Brecha (%)"
    ) +
    geom_hline(
      yintercept = mean(brecha_edades$brecha_paro[brecha_edades$Periodo == año], na.rm = TRUE),
      color = "grey10",
      linetype = "dashed",
      linewidth = 1
    ) +
    theme_minimal() +
    theme(
      plot.title = element_text(size=8,face="bold"),
      axis.text.x = element_text(angle = 45, hjust = 1),
      plot.margin = margin(15, 30, 15, 30)  # <-- añade espacio alrededor del gráfico
    )
})

library(cowplot)

plot_grid(
  plotlist = graficos_brecha_paro[1:4],
  ncol = 2,
  labels = c("2024", "2023", "2010", "2007")  # opcional
)
```
Los gráficos resultantes muestran, de forma clara, cómo la intensidad de la brecha de género en el desempleo varía según la edad y el momento temporal. En los primeros años analizados, la brecha es especialmente elevada entre los jóvenes, lo que evidencia una mayor vulnerabilidad del empleo femenino en los jóvenes. En cambio, en los años más recientes para esos tramos de edad, las diferencias tienden a moderarse y presentan un patrón más equilibrado entre grupos, aunque persisten desigualdades estructurales en los segmentos de mayor edad y los más jóvenes.

Este bloque  busca ofrecer una visión desagregada y evolutiva de la brecha de paro por edad. Gracias a la representación mediante diagramas de barras, se facilita la comparación entre grupos generacionales y se identifican con claridad los grupos que más contribuyen a mantener las disparidades laborales entre hombres y mujeres a lo largo del tiempo.


```{r, echo=FALSE}
brecha_relativa <- df_clean %>%
  group_by(Periodo, Sexo) %>%
  summarise(Tasa = mean(Tasa_actividad, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = Sexo, values_from = Tasa) %>%
  mutate(Razon = Hombres / Mujeres)
```

```{r, echo=FALSE}
ggplot(brecha_relativa, aes(x = Periodo, y = Razon)) +
  geom_line(linewidth = 1.2) +
  scale_y_continuous(breaks = seq(1, 1.5, by = 0.05)) + 
  scale_x_continuous(breaks = seq(2006, 2024, by = 2)) + 
  labs(
    title = "Evolución de la razón de la tasa de actividad Hombres/Mujeres",
    x = "Año",
    y = "Razón tasa de actividad (Hombres / Mujeres)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )
```
Esta gráfica muestra cómo ha cambiado la relación entre la tasa de actividad de los hombres y la de las mujeres a lo largo del tiempo. Cada punto representa el cociente entre ambas tasas en un año determinado. Una razón superior a 1 indica que los hombres tienen mayor participación en el mercado laboral que las mujeres. Desde 2006, la razón ha descendido de forma sostenida, lo que refleja una reducción progresiva de la brecha de género. Aunque no se ha alcanzado la igualdad, las mujeres han incrementado su participación relativa.


<!-- # ```{r} -->
<!-- # # Filtrar para excluir el grupo de edad "70 y más años" -->
<!-- # brecha_edad_filtrada <- df_clean %>% filter(Edad != "70 y más años") -->
<!-- #  -->
<!-- # # Graficar la razón Hombres/Mujeres por edad (sin el grupo de 70) -->
<!-- # ggplot(brecha_edad_filtrada, aes(x = Periodo, y = Razon, color = Edad)) + -->
<!-- #   geom_line(linewidth = 1) + -->
<!-- #   geom_hline(yintercept = 1, linetype = "dashed", color = "gray") + -->
<!-- #   scale_y_continuous(breaks = seq(0.5, 2, by = 0.1)) + -->
<!-- #   scale_x_continuous(breaks = seq(2006, 2024, by = 2)) + -->
<!-- #   labs( -->
<!-- #     title = "Razón Hombres/Mujeres en la tasa de actividad por edad (sin 70+)", -->
<!-- #     x = "Año", -->
<!-- #     y = "Razón (Hombres / Mujeres)", -->
<!-- #     color = "Edad" -->
<!-- #   ) + -->
<!-- #   theme_minimal() + -->
<!-- #   theme(axis.text.x = element_text(angle = 45, hjust = 1)) -->
<!-- #  -->
<!-- #  -->
<!-- # ``` -->


# Distribución de la población en el mercado laboral

## Composición del mercado laboral 

En el siguiente gráfico se muestra la composición del mercado laboral, separando entre: Parados, Ocupados e Inactivos para cada grupo de edad, separado por sexo.

```{r, echo=FALSE}

datos_composicion<- df_clean  %>% 
  select(Periodo,Edad,Sexo,Activos,Ocupados,Parados,Inactivos) %>% 
  pivot_longer(cols = c(Inactivos,Ocupados,Parados),names_to = "Estado",values_to = "N_Personas")

años1 <- c(2024, 2006)

graficos_composicion_por_año <- lapply(años1, function(año) {
  datos_composicion %>%
    filter(Periodo == año) %>%
    ggplot(aes(
      x = factor(Edad, levels = unique(Edad)),
      y = N_Personas,
      fill = Estado
    )) +
    geom_col(position = "fill") +
    labs(
      title = paste("Composición del mercado laboral por grupo de edad -", año),
      x = "Grupo de edad",
      y = "Proporción",
      fill = "Estado"
    ) +
    theme_minimal() +
    theme(
      axis.text.x = element_text(angle = 45, hjust = 1),
      plot.margin = margin(15, 30, 15, 30)  # ← más espacio alrededor del gráfico
    ) +
    facet_wrap(~Sexo) # Añadir o quitar según quieras comparar hombres y mujeres
})

graficos_composicion_por_año


```
Del análisis de los gráficos se observa una estructura bastante estable del mercado laboral por edad y sexo a lo largo del tiempo, con ligeras variaciones asociadas a los ciclos económicos. En ambos sexos, el grupo central de edad (30-54 años) concentra la mayor proporción de personas ocupadas, mientras que los extremos —jóvenes y mayores— presentan una mayor presencia de inactivos. Las mujeres muestran sistemáticamente una menor proporción de ocupación y una mayor de inactividad en comparación con los hombres, aunque esta diferencia tiende a reducirse en los años más recientes. Asimismo, la proporción de personas paradas es más significativa en los grupos jóvenes, reflejando una mayor vulnerabilidad del empleo juvenil. En conjunto, los gráficos ponen de manifiesto que, pese a los avances en participación femenina y la estabilidad general del empleo en edades medias, persisten desigualdades de género e importantes diferencias intergeneracionales dentro del mercado laboral.

Estas gráficas, también ponen de manifiesto un proceso de envejecimiento del desempleo y una convergencia progresiva entre hombres y mujeres en la estructura interna del paro, aunque todavía persisten diferencias derivadas de los roles laborales y sociales tradicionales. Mientras los hombres mayores ganan peso dentro del paro total por el retraso en la jubilación, las mujeres siguen mostrando una mayor vulnerabilidad en las edades centrales, reflejando las desigualdades de género que aún caracterizan el mercado laboral español.


# Análisis estadístico

<!-- # ```{r, echo=FALSE} -->
<!-- # df_clean %>% group_by(Sexo) %>% summarise(sd_ocupados = sd(Ocupados, na.rm = TRUE),var_ocupados = var(Ocupados, na.rm = TRUE)) -->
<!-- #  -->
<!-- # ``` -->
<!-- #  -->
<!-- # ```{r, echo=FALSE} -->
<!-- #  -->
<!-- # tabla_dispersion <- df_clean %>% -->
<!-- #   group_by(Sexo) %>% -->
<!-- #   summarise( -->
<!-- #     `Desviación estándar (Ocupados)` = sd(Ocupados, na.rm = TRUE), -->
<!-- #     `Varianza (Ocupados)` = var(Ocupados, na.rm = TRUE) -->
<!-- #   ) -->
<!-- #  -->
<!-- # kable(tabla_dispersion, caption = "Desviación estándar y varianza de ocupados por sexo") -->
<!-- #  -->
<!-- # ``` -->


Para validar estadísticamente las diferencias observadas ente las series temporales por sexo se va a realizar una prueba de t de Student para las dos principales métricas del mercado laboral, la tasa de actividad y la de paro. Los resultados se pueden observar en la siguiente tabla:

```{r,echo = FALSE}

test_actividad <- t.test(Tasa_actividad ~ Sexo, data = df_clean)
test_paro <- t.test(Tasa_paro ~ Sexo, data = df_clean %>% filter(Outlier_paro=="Normal"))

tabla_ttest <- data.frame(
  Tasa = c("Actividad", "Paro"),
  t = c(round(test_actividad$statistic, 3),
        round(test_paro$statistic, 3)),
  df = c(round(test_actividad$parameter, 2),
         round(test_paro$parameter, 2)),
  `p-value` = c(round(test_actividad$p.value, 4),
                round(test_paro$p.value, 4))
)

# Mostramos la tabla con kable
kable(tabla_ttest,
      caption = "Resultados de las pruebas t para comparar las tasas entre sexos",
      align = "lccc")
```

Como se observa en esta tabla, la tasa de actividad presenta un valor $p$ extremadamente bajo ($0.001$), lo que permite rechazar la hipótesis nula y por lo tanto, la tasa de actividad depende del sexo.

Por otro lado, la tasa de paro muestra un valor de p también bajo ($0.0227$) rechazando de la misma forma la hipótesis nula.

Por lo tanto, tanto la tasa de paro como la tasa de actividad dependen del sexo de la persona.



# Conclusión

Mediante el análisis gráfico se ha observado que la tasa de actividad masculina es superior, aunque se va reduciendo progresivamente. También se aprecia que las mayores diferencias se dan en los grupos de mediana edad que coinciden con las etapas de mayor carga familiar y laboral.
En términos de la composición del mercado laboral, se aprecia claramente las mujeres siguen mostrando una mayor inactividad y ocupación en el empleo aunque las diferencias se reducen gradualmente.


Para completar las gráficas de una forma rigurosa se ha hecho una prueba de t de student en la que se ha obtenido como resultado que la dependencia entre la tasa de actividad y paro con el sexo es estadísticamente significativo, esto nos permite concluir que la brecha de género existe en el mercado laboral.

Por tanto, con este análisis sobre la brecha de genero se ha podido detectar como esta brecha ha sido real en el intervalo de tiempo estudiado.

La sociedad actual debería poner mas atención a esta brecha y, por ende, promover diferentes políticas que beneficien la conciliación laboral y fomenten la inclusión laboral femenina.


